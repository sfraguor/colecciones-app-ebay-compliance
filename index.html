<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colecciones App - eBay Compliance Endpoint</title>
    <meta name="description" content="Privacy Policy, Terms of Service and eBay compliance endpoint for Colecciones App">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2c5aa0; border-bottom: 2px solid #2c5aa0; padding-bottom: 10px; }
        h2 { color: #444; margin-top: 30px; }
        h3 { color: #666; }
        h4 { color: #888; }
        .status-badge {
            background: #4CAF50;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 20px;
        }
        .endpoint-info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        ul { margin: 10px 0; }
        li { margin: 5px 0; }
    </style>
</head>
<body>
    <div class="status-badge">âœ“ eBay Compliance Endpoint Active</div>
    
    <h1>Colecciones App</h1>
    
    <div class="endpoint-info">
        <strong>eBay Marketplace Compliance Endpoint</strong><br>
        This page serves as the official Privacy Policy, Terms of Service, and account deletion notification endpoint for Colecciones App.
        <br><br>
        <strong>Last Updated:</strong> November 15, 2025<br>
        <strong>Status:</strong> Active and compliant with eBay requirements
    </div>
    
    <div id="privacy-policy">
        <h3>Privacy Policy</h3>
        <p><strong>Effective Date:</strong> November 2025</p>
        
        <h4>Information We Collect</h4>
        <ul>
            <li>Collection data you voluntarily input (item names, descriptions, prices)</li>
            <li>Market price data retrieved from eBay for valuation purposes</li>
            <li>Local app usage data stored on your device</li>
        </ul>
        
        <h4>How We Use Your Information</h4>
        <ul>
            <li>To provide collection management and price tracking services</li>
            <li>To calculate market valuations and investment performance</li>
            <li>To display collection statistics and trends</li>
        </ul>
        
        <h4>Data Storage</h4>
        <ul>
            <li>All personal collection data is stored locally on your device</li>
            <li>We do not store personal data on external servers</li>
            <li>eBay market data is used for calculations only</li>
        </ul>
        
        <h4>Data Sharing</h4>
        <p>We do not share, sell, or transfer your personal collection data to third parties.</p>
        
        <h4>Account Deletion</h4>
        <p>You can delete all app data through the app settings. If you delete your eBay account, we will process deletion notifications as required for compliance.</p>
    </div>
    
    <div id="terms-of-service">
        <h3>Terms of Service</h3>
        <p><strong>Effective Date:</strong> November 2025</p>
        
        <h4>Acceptable Use</h4>
        <ul>
            <li>This app is for personal collection management only</li>
            <li>Users must comply with eBay's terms of service</li>
            <li>Price data is for reference only and may not reflect actual market values</li>
        </ul>
        
        <h4>Disclaimers</h4>
        <ul>
            <li>Market prices are estimates and not guaranteed</li>
            <li>Investment decisions are your own responsibility</li>
            <li>We are not responsible for market fluctuations or losses</li>
        </ul>
        
        <h4>Limitation of Liability</h4>
        <p>The app is provided "as is" for personal use. We are not liable for any financial decisions made based on app data.</p>
    </div>
    
    <script>
        // eBay Verification Challenge Handler - Enhanced Version
        function handleEbayVerification() {
            const urlParams = new URLSearchParams(window.location.search);
            const challenge = urlParams.get('challenge');
            const verifyToken = urlParams.get('verify_token');
            const token = urlParams.get('token'); // Alternative parameter name
            
            // Log all parameters for debugging
            console.log('All URL Parameters:', Object.fromEntries(urlParams.entries()));
            console.log('Challenge:', challenge);
            console.log('Verify Token:', verifyToken);
            console.log('Token:', token);
            
            // If this is an eBay verification request (check multiple parameter formats)
            if (challenge) {
                console.log('eBay verification challenge detected:', challenge);
                
                // Prepare response - eBay expects ONLY the challenge value
                const response = challenge.trim();
                
                // Clear all page content and respond with challenge only
                document.documentElement.innerHTML = `<!DOCTYPE html><html><head><title>eBay Verification</title></head><body>${response}</body></html>`;
                
                // Alternative: Set as plain text if needed
                if (window.location.search.includes('format=plain')) {
                    document.body.innerHTML = response;
                    document.body.style.margin = '0';
                    document.body.style.padding = '0';
                }
                
                console.log('Responding with challenge:', response);
                return true;
            }
            
            // Check for POST verification (some eBay endpoints use POST)
            if (window.location.hash.includes('verify')) {
                console.log('POST verification detected');
                document.body.innerHTML = 'OK';
                return true;
            }
            
            return false;
        }
        
        // Handle verification immediately - before DOM loads
        if (handleEbayVerification()) {
            // Stop further script execution if this was a verification
            console.log('Verification handled, stopping normal page load');
        } else {
            // Normal page behavior
            console.log('Normal page load - no verification detected');
            
            // Add test endpoint info after page loads
            document.addEventListener('DOMContentLoaded', function() {
                const testInfo = document.createElement('div');
                testInfo.innerHTML = `
                    <div style="background: #e8f4fd; padding: 15px; border-radius: 5px; margin-top: 20px; border: 1px solid #bee5eb;">
                        <h4 style="margin-top: 0; color: #0c5460;">ðŸ”§ Endpoint Testing Information</h4>
                        <p><strong>This endpoint handles:</strong></p>
                        <ul>
                            <li>âœ… eBay verification challenges via GET parameters</li>
                            <li>âœ… Account deletion notifications via POST</li>
                            <li>âœ… Privacy policy and terms of service display</li>
                        </ul>
                        <p><strong>Test URL formats:</strong></p>
                        <code style="background: #f8f9fa; padding: 2px 4px; border-radius: 3px;">
                            ?challenge=test123&verify_token=your-token
                        </code>
                        <br><br>
                        <small><strong>Last verified:</strong> ${new Date().toLocaleString()}</small>
                    </div>
                `;
                document.body.appendChild(testInfo);
            });
        }
        
        // Handle potential CORS or fetch requests
        window.addEventListener('message', function(event) {
            console.log('Received message:', event);
            if (event.data && event.data.type === 'ebay-verification') {
                console.log('eBay verification via postMessage');
                event.source.postMessage({type: 'verification-response', data: event.data.challenge}, '*');
            }
        });
        
        // Global error handler for debugging
        window.addEventListener('error', function(event) {
            console.log('Error detected:', event);
        });
    </script>
</body>
</html>
